# Griffin-BISON Multiphysics Steady State Model

## KRUSTY Mesh Model

!media https://www.youtube.com/embed/xvwhdcug14g

The KRUSTY mesh employed in the simulations was generated by using MOOSE mesh generator tools including `ParsedCurveGenerator`, `XYDelaunayGenerator`, `CircularBoundaryCorrectionGenerator`, and `PeripheralTriangleMeshGenerator`, etc. Combinations of these tools facilitate the formation of sophisticated meshes while maintaining their volume integrity. [krusty_model_mesh] (A) shows the comprehensive core mesh from MOOSE, while a detailed 2D mesh sample from the core's center is provided in [krusty_model_mesh] (B). An input example of combining `ParsedCurveGenerator` and `XYDelaunayGenerator` to generate a 2D mesh of irregular shape (blue mesh in [krusty_model_mesh] (C), which is part of the 2D mesh of the KRUSTY fuel region ([krusty_model_mesh] (B))) is shown in [mg_reg2].

The KRUSTY mesh is 1/4 angular symmetric and could be divided into half or quarter meshes using `PlaneDeletionGenerator` or `CartesianMeshTrimmer` objects. [krusty_quarter_mesh] shows the quarter mesh generated following these steps. The quarter core mesh was adopted in the simulations.

!media media/KRUSTY/krusty_model_mesh.png
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=krusty_model_mesh
      caption= (A) KRUSTY model; (B) the 2D mesh of KRUSTY fuel region with heat pipes; (C) the enlarged framed area in (B). 

!listing microreactors/KRUSTY/MESH/KRUSTY_mesh_gen_griffin.i
         block=Region2
         id=mg_reg2
         caption=Input to generate a 2D mesh of irregular shape.

!media media/KRUSTY/krusty_quarter_mesh.png
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=krusty_quarter_mesh
      caption= Quarter-core KRUSTY mesh generated using MOOSE

## KRUSTY Cross Section Generation

KRUSTY is a small fast spectrum core with a significant amount of neutrons leaking out of the fuel region. The energy spectrum shifts due to neutron leakages and thermal neutrons returning from the reflectors. Therefore, the KRUSTY fuel region was divided into seven radial regions and six axial zones as shown in [krusty_model_mesh] for applying different cross sections for different fuel regions.

Both Serpent and MC2-3 were used to prepare cross sections for modeling KRUSTY. Sensitivity analysis showed that MC2-3 provides better anisotropic scattering cross sections in the BeO reflector regions, and Serpent provides better cross sections in the fuel region for accounting for the fuel Doppler reactivity feedback. Therefore, a hybrid multigroup cross section set that used MC2-3 cross sections in the reflector region and used Serpent cross sections in other regions was prepared for modeling KRUSTY.

The MC2-3 calculation takes a two-step approach. The first step creates energy self-shielded cross sections and the number of energy-groups used is larger than 1000 groups. These cross sections are imported into an approximated RZ model of KRUSTY as shown in [twodant]. A neutron transport calculation was performed by TWODANT to solve the neutron fluxes in each material region in the RZ model. The neutron fluxes calculated by TWODANT have considered both the neutron leakage effects and spatial self-shielding effects and were imported into the MC2-3 second step. Multigroup cross sections were condensed based on the TWODANT fluxes in each material zone. [energy_group] lists the 22-group structure used in the calculations. The MC2-3 input for the first step and the input for TWODANT are documented in [`mc_s1.in`](/mc_s1.in). The MC2-3 input for the second step calculation is similar to the input in the first step but has a different control block as shown in [mc23_s2].



!media media/KRUSTY/twodant_model.png
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=twodant
      caption= KRUSTY RZ model for TWODANT calculation

!listing microreactors/KRUSTY/Neutronics/MC23/mc_s1.in
         start=$control
         end=$material
         id=mc23_s1
         caption=MC2-3 input control block (step 1 calculation)

!listing microreactors/KRUSTY/Neutronics/MC23/mc_s2.in
         start=$control
         end=$groupstructure
         id=mc23_s2
         caption=MC2-3 input control block (step 2 calculation)

!table id=energy_group caption=The 22-Energy Group Structure for Modeling KRUSTY
| Group # | Upper bond (MeV) | Group # | Upper bond (MeV) | Group # | Upper bond (MeV) |
| - | - | - | - | - | - |
| 1       | 1.4191E+01        | 9       | 1.5034E-02        | 17      | 8.3153E-06        |
| 2       | 1.0000E+01        | 10      | 5.5308E-03        | 18      | 3.9279E-06        |
| 3       | 6.0653E+00        | 11      | 2.0347E-03        | 19      | 1.8554E-06        |
| 4       | 2.2313E+00        | 12      | 7.4852E-04        | 20      | 1.1254E-06        |
| 5       | 8.2085E-01        | 13      | 2.7536E-04        | 21      | 8.7642E-07        |
| 6       | 3.0197E-01        | 14      | 7.8893E-05        | 22      | 4.1745E-07        |
| 7       | 1.1109E-01        | 15      | 3.7267E-05        |         |                   |
| 8       | 4.0868E-02        | 16      | 1.3710E-05        |         |                   |

## Griffin Stand-Alone Neutronic Model

The standalone Griffin input for the neutronic model of KRUSTY is included. [griffin_mesh_subdomain] shows the mesh block of this input that was used to generate the unstructured file `Griffin_mesh.e`. The volume for each material region in the mesh file is preserved and made to be consistent with the KRUSTY Serpent reference model. All heat pipe locations are filled. The list in the `subdomains` block references block ids in the mesh file, and the `extra_element_ids` is the list of material ids filling the mesh block.

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         start=Mesh
         end=coarse_mesh
         id=griffin_mesh_subdomain
         caption=Griffin mesh block for subdomain element IDs assignment.

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         start=coarse_mesh
         end=parallel_type
         id=griffin_mesh_coarse
         caption=Griffin mesh block for coarse mesh definition for CMFD acceleration

The KRUSTY mesh file has modeled 1/4th of the core with reflecting boundaries applied at the center-cut planes. Vacuum boundary conditions are applied on the KRUSTY top, bottom surface, as well as on its outermost radial surface as shown in [griffin_bc].

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         start=TransportSystems
         end=sn
         id=griffin_bc
         caption=Boundary conditions of the Griffin neutronic model for KRUSTY.

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         start=sn
         end=PowerDensity
         id=transport_params
         caption=Transport system defined in Griffin neutronic model for KRUSTY.

The Griffin neutronic model solves the $k_{eff}$ and the flux distributions at critical state. [transport_params] shows the transport system block. It used the DFEM-SN solver. Spatial variables are discretized by the DFEM method with shape functions from the first order MONOMIAL family. Angular variables are discretized by the SN method using the Gauss-Chebyshev quadratures. Sensitivity analysis were performed and results were included in [opt_params] with different orders of anisotropic scattering terms and different number of angles used in discretizing the angular space. It showed that the calculated $k_{eff}$ was converged after using NPolar=3 angles per octant in the polar direction and NAzmthl=5 angles per octant in the azimuthal direction. With scattering term NA=3, Griffin neutronic model provides better agreement to the Serpent reference $k_{eff}$ among these cases. Including higher scattering order terms may further improve the accuracy of the neutronic results but will require a lot more computational resources. In the Multiphysics model, the neutronic model used NA=3, NPolar=2 and NAzmthl=3 in order to further reduce computational time. As shown in [transport_params], six groups of delayed neutron group families were considered in the numerical calculations. Six delayed neutron data were obtained using Serpent and the values for each group were included in the ISOXML cross section file.

!table id=opt_params caption=Results comparison of different orders of anisotropic scattering terms and different number of angles used in discretizing the angular space.
|   | Serpent | Griffin (NA=1) |   |   |   |   | Griffin (NA=2) | Griffin (NA=3) |   |
| - | - | - | - | - | - | - | - | - | - |
|   |   | SN(1,3) | SN(2,3) | SN(2,5) | SN(3,5) | SN(3,7) |  SN(3,5) | SN(3,5) | SN(2,3) |
| $k_{eff}$ | 1.00592 | 0.99434 | 0.99750 | 0.99751 | 0.99853 | 0.99854 | 1.01125 | 1.00815 | 1.00703 |
| $\Delta k_{eff}$ (pcm) = $k_{eff,Serpent}-k_{eff,Griffin}$ |   | 1158 | 842 | 841 | 749 | 738 | -533 | -223 | -111 |


[exec] shows the executioner block in the Griffin input where the maximum number of allowed iterations and convergence criteria are specified. The `SweepUpdate` executioner unique for DFEM-SN was used. The Coarse-Mesh Finite Difference (CMFD) method was deployed to accelerate the DFEM-SN solver. The coarse mesh for the low-order diffusion calculation was a regular mesh that was generated in the mesh block as shown in [griffin_mesh_coarse]. The maximum diffusion coefficient was set to 10.0, as a limit value facilitating convergence in problems that contain void regions. It can be adjusted and will not significantly affect the accuracy of the results. Newton’s method was used to solve the low-order diffusion equation. Another option to use is the krylovshur method. It was found that it is important to use preconditioners for solving the diffusion equation in order to converge the DFEM-SN solver with CMFD acceleration. In this case, the LU decomposition was used and was found to be effective. The multiplicative prolongation was chosen to update all transport flux moments after solving the low-order diffusion calculation.

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         block=Executioner
         id=exec
         caption=Griffin executioner block with options for CMFD acceleration.

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         block=Materials
         id=input_mat
         caption=The Materials block of the input file

!listing microreactors/KRUSTY/Neutronics/Griffin/krusty_ANL22_endf70_hybrid_SN35_NA3_coarse_CMFD.i
         block=AuxVariables
         id=input_auxvar
         caption=AuxVariables defined for cross section grid indices in Griffin neutronic model for KRUSTY

[input_mat] shows the material block in the Griffin input. The `CoupledFeedbackMatIDNeutronicsMaterial`, which interpolates multigroup cross sections on-the-fly among a tabulated cross section set, was used for multiphysics simulation. The material ID was read from the mesh block. The hybrid cross section set that was generated from Serpent and MC2-3 was used. The cross sections within the file are zone-averaged macroscopic cross sections. Therefore, the isotopes were assigned to be ‘pseudo’ and its density was 1.0.

The cross section set included a 2-D cross section table. The indices to lookup the 2-D table were the fuel temperature “Tf” and the structure temperature “Ts” that covers all other nonfuel regions. The state temperature points include fuel at 300 K, 600 K, 800 K, 1000 K and 1200 K and the structure material at 300 K, 600 K, 800 K and 1000 K, respectively. [input_auxvar] shows how different fuel and structure temperatures can be specified in the stand-alone neutronic calculations.

Finally, [axial_output] shows the steps to tally the axial power distribution in the KRUSTY innermost (“r1”) layer. To integrate the fission power within each fuel layer (seven radial layers), an `AuxVariable` in MOOSE that can be processed by the `VectorPostprocessor` was first defined to hold the layer-integrated total fission power for the axial regions within that layer as shown in the first block of [axial_output]. A `UserObject` as shown in the second block of [axial_output] was necessary to perform the actual integration among the different axial layers. The integrated values were then placed into the `AuxVariable` as shown in the third block of [axial_output] and were printed out by the `VectorPostprocessor` as shown in the fourth block of [axial_output].

!listing id=axial_output caption=Output blocks in Griffin neutronic model for KRUSTY to tally the power density in one of the fuel region: AuxVariable block; UserObject block; AuxKernel block; VectorPostprocessor block
[AuxVariables]
  [axial_r1_z]
    order = FIRST
    family = MONOMIAL
  []
[]
[UserObjects]
  [axial_r1_z]
    type = LayeredIntegral
    variable = power_density
    direction = z
    bounds = '35 36 37 38 39 40.083435 41.16687 42.250305 43.33374 43.97763
              44.62152 44.85012 45.11512 45.38012 46.19006 47 48.09006 49.18012
              49.71012 49.95142 50.80945 51.66748 52.50061 53.33374 54.16687
              55 55.8416779 56.6833558 57.5250337 58.3667116 59.1839658 60.00122'
    block = '2081 2082 3081 3082 4081 4082'
  []
[]
[AuxKernels]
  [axial_r1_z]
    type = SpatialUserObjectAux
    variable = axial_r1_z
    execute_on = timestep_end
    user_object = axial_r1_z
  []
[]
[VectorPostprocessors]
  [axial_r1_z_elm]
    type = ElementValueSampler
    variable = axial_r1_z
    sort_by = z
    execute_on = timestep_end
  []
[]

## BISON Thermal-Mechanical Model

BISON was utilized to conduct thermo-mechanical simulations. In KRUSTY, the fuel disk and its radial shield hung down from the top stainless-steel plates. The bottom and radial reflectors sat on a movable platen below the fuel disk and were pushed up into the radial shield region to reach criticality. With very good insulation of the fuel disk, the top and bottom plates were about room temperature. Therefore, the reactor core was modeled between the fixed top and bottom surfaces with no total displacement in the axial direction but allowing radial thermal expansion or contraction. The top and bottom parts of KRUSTY were connected by “soft materials” to represent the vacuum and air region surrounding the fuel disk. In the KRUSTY thermo-mechanical model, the radial reflector expands upward into the “soft material” region when the fission power increases, and the fuel expansion is downward resulting in more part of fuel covered by the reflectors. Convective heat flux boundary conditions (h=5 W/m²·K) were applied to the top, bottom, and side surfaces of the core.

For a thermo-mechanical model, thermophysical properties (i.e., thermal conductivity, density, specific heat, and thermal expansion coefficient) and mechanical properties (i.e., elastic modulus) of all the involved components are needed. [thm_model] lists the BISON/MOOSE models used for thermo-mechanical simulations. BISON doesn't include models for KRUSTY’s U-7.65Mo fuel material, so the thermal conductivity of U-10Mo and specific heat of U-8Mo are currently applied. Other thermal and mechanical attributes for U-7.65Mo and B4C were sourced from the open literature or based on certain assumptions. The displacements in the “soft materials” regions are not solved using MOOSE’s solid mechanics solver as the solid components. Instead, simple diffusion is used for these regions to simply propagate the deformation of the solid components.

!table id=thm_model caption=Thermophysical and Elasticity Models Used for Thermo-Mechanical Simulation
| BISON/MOOSE models                   | Materials | Description                                           |
| - | - | - |
| HeatConductionMaterial               | UMo       | Thermal properties of UMo [!citep](Parida2001,Burkes2010)                    |
| BeOThermal                           | BeO       | Thermal properties of BeO                             |
| BeOElasticityTensor                  | BeO       | Young's modulus and Poisson's ratio for BeO           |
| BeOThermalExpansionEigenstrain       | BeO       | Computation of eigenstrain due to thermal expansion in BeO |
| SS316Thermal                         | SS        | Thermal properties of SS-316                          |
| SS316ElasticityTensor                | SS        | Young's modulus and Poisson's ratio for SS-316        |
| SS316ThermalExpansion Eigenstrain    | SS        | Computation of eigenstrain due to thermal expansion in SS316 |

As mentioned above, in the KRUSTY design, a thin insulation layer is used to thermally isolate the fuel from other components to reduce the loss of energy through heat transfer from fuel to reactor external surface. In order to simulate the thermal behavior of this thin insulation layer, MOOSE’s interface kernel is adopted to model the thermal resistance of the insulation layer without the need to explicitly mesh the thin structure. The thermal resistance of the insulation layer is tuned to match the reported behavior of KRUSTY (i.e., 30 W power leading to 200ºC fuel temperature).

## MOOSE Multiphysics Coupling

In KRUSTY warm critical experiments, the power excursion transient was initiated by shifting the radial reflector of KRUSTY upward to insert positive reactivity when the reactor was in a cold/critical state [!citep](Poston2020_1). This VTB model includes the multiphysics model prepared for modeling this reactivity insertion test. A two-level MOOSE MultiApps hierarchy which tightly couples the aforementioned Griffin neutronics model and BISON thermo-mechanical model has been developed to simulate the KRUSTY warm critical tests. Griffin is set as the parent (main) application and uses the DFEM-SN(2,3) solver with CMFD acceleration and NA=3 (anisotropic scattering order), while BISON is set as the child application.

The power density profile, initially calculated by Griffin, is then transferred to BISON. In BISON, thermo-mechanical computations take place, allowing for the determination of temperature distribution within all solid components. This subsequently leads to the calculation of thermal expansion. Both the fuel temperature profile and displacement field are then sent back to Griffin as feedback for the neutronics simulation. The coupling of these two applications occurs through fixed point iteration. Notably, in this calculation, all heat is passively removed through the external boundary of the reactor, as no heat pipes are involved.

The movement of the axial reflector to insert the reactivity was modeled by forcing a Dirichlet boundary condition on the bottom of the solid assembly that includes the axial reflector to allow BISON to calculate the consequent displacement field through solving solid mechanics equations. Two steady-state eigenvalue calculations were included in the VTB model. These calculations were performed to confirm that an adequate amount of external reactivity was introduced for initiating the transient. The first one corresponds to the initial steady state for future transient simulation, and the second steady state corresponds to the first step of the transient after the reflector is shifted upward. In this calculation, the bias in the axial direction was set in the BISON input as shown in [mov_refl] to generate the displacement in the mesh. The displacements were passed to Griffin neutronic for calculating the total reactivity inserted into the reactor using the MultiApp coupling framework.

!listing id=mov_refl caption=Bison inputs for modeling the movement of the axial reflectors in KRUSTY warm critical experiments
reflector_disp = 0.0 # use 1.48e-3 for reactivity insertion
[BCs]
  [BottomSSFixZ]
    type = DirichletBC
    variable = disp_z
    boundary = 'ss_bot'
    value = ${reflector_disp}
  []
[]