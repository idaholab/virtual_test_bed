# GCMR Assembly Multiphysics Model

*Point of Contact: Ahmed Abdelhameed (aabdelhameed.at.anl.gov), Yinbin Miao (ymiao.at.anl.gov), Nicolas Stauff (nstauff.at.anl.gov)*

*Model link: [GCMR Assembly Model](https://github.com/idaholab/virtual_test_bed/tree/devel/microreactors/gcmr/assembly)*

!tag name=Gas-Cooled Microreactor Assembly pairs=reactor_type:microreactor
                       reactor:GCMR
                       geometry:assembly
                       simulation_type:multiphysics
                       code_used:BlueCrab;Griffin;BISON
                       input_features:multiapps
                       transient:steady_state;RIA;flow_blockage
                       computing_needs:HPC
                       fiscal_year:2023

## Mesh files

!alert note
The meshes for this model are hosted on LFS. Please refer to [LFS instructions](resources/how_to_use_vtb.md#lfs)

The 3-D mesh for the GC-MR assembly displayed in [Fig_2] was generated by MOOSE intrinsic meshing tools available in the [`Reactor module`](https://mooseframework.inl.gov/modules/reactor/index.html). This MOOSE-based tool allows a direct construction of assembly or reactor core mesh from simple cartesian and hexagonal unit geometries. The Reactor Module consists of a series of mesh generators to enable meshing of reactor cores. Using MOOSE mesh generators for constructing meshes for reactor geometries entails following the intrinsic geometric hierarchy where the unit cartesian or hexagonal structures (e.g., unit pin-cell structures of control rod, fuel pin) can be assembled into fuel assemblies. The objects in Reactor Module provides direct control of mesh/element size through the input parameters. Adjusting the mesh density from coarse to fine takes little time, streamlining sensitivity analyses on mesh refinement. The consistency between the geometrical representations in the mesh file and the cross-section generation code was verified by directly comparing the volumes of the different blocks/universes. In this example, only the fine mesh is needed for the Griffin input, which is given in `Griffin_mesh.e`, and Griffin generates the coarse mesh required for the CMFD acceleration as such:

!listing microreactors/gcmr/assembly/steady_state/Griffin_steady_state.i block=Mesh


!media media/gcmr/Fig_2.jpg
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=Fig_2
      caption= Three-D mesh representation of the GC-MR assembly

For analysis of the multi-physics, BISON and SAM were coupled with Griffin. A different mesh file were used `BISON_mesh.e` in which the coolant channels where removed from the 3-D solid mesh, as the coolant channels were handled separately by SAM. It should be noticed that BISON and SAM are coupled through coolant channel surface.


## Griffin Model


For modeling the GC-MR Assembly in 3-D, the neutron transport equation was solved by Griffin using the discrete ordinates SN method for the angular discretization while the discontinuous finite method (DFEM) method was used for the spatial discretization [!citep](Ahmed_ANS_2022) [!citep](Nicolas_ANS_2022). The coarse mesh finite element method (CMFD) acceleration was used to speed up the DFEM solver. On-the-fly coarse mesh generation is done with Griffin. This means that the user doesn’t need to provide a separate coarse mesh file for the calculations.  In Griffin, the coarse element IDs of elements on the fine mesh are assigned through overlaying a regular grid, i.e., the elements whose centroids falls into the same regular grid are assigned with the same coarse element ID.

The homogenized multigroup cross-sections were generated using Serpent-2 with ENDF/B-VII.1 data library and then converted to XML-format cross section file and they functionalized with the fuel temperature for eleven energy groups structure. These multigroup structures were generated for the beginning of the cycle condition.  The process of generating the multi-group cross-sections using Serpent-2 is outside the scope of this example. The multi-group cross-sections for the various materials are assigned to fill the various blocks of the mesh file.  In this problem the materials_id of each material is given one of the numbers from 801 to 810. While the numbers of the mesh blocks are: 10, 100, 102, 103, 200, 201, 300, 400, 401, 500, 600, 8000, and 8001.  They are specified in the `[Mesh]` block as follows:


!listing microreactors/gcmr/assembly/steady_state/Griffin_steady_state.i start=subdomains end=[]

While `CoupledFeedbackMatIDNeutronicsMaterial` material `type` was used in the `[Materials]`
block:


!listing microreactors/gcmr/assembly/steady_state/Griffin_steady_state.i block=Materials


Griffin reads the XML-format cross-section file, `XS_Griffin`, and a mesh file `Griffin_mesh.e` that specifies the 3-D mesh which has the same geometry as the one used in the cross-section generation code. The consistency between the volumes of the different materials in the Serpent-2 model and in the 3-D mesh were directly compared to verify the geometrical consistency.

The 3-D GC-MR assembly was solved with reflective boundary condition radially and vacuum boundary conditions axially on the top and bottom reflector boundaries. In both the steady-state and the transient Griffin calculations, the DFEM-SN with CMFD was used. Because good accuracy was obtained with the eleven energy groups structure, only small numbers of polar and azimuthal angles were used with the SN solver:


!listing microreactors/gcmr/assembly/steady_state/Griffin_steady_state.i block=TransportSystems


## BISON Model

BISON enables thermal-mechanical computation of a reactor core that consists of multiple components/materials, and it was employed to model the heat conduction of the GC-MR assembly. BISON contains a solid list of material properties that are applied in this model, including a recent update of graphite properties. These models include: `GraphiteGradeCreepUpdate`, `GraphiteGradeElasticityTensor`, `GraphiteGradeIrradiationEigenstrain`, `GraphiteGradeThermalExpansionEigenstrain`, `GraphiteMatrixThermal`, and `GraphiteMatrixThermalExpansionEigenstrain`. The updated `GraphiteMatrixThermal` that computes thermal conductivity (W/m/K) and specific heat capacity (J/kg/K). The BISON input files for steady-state and transient cases are `BISON.i` and `BISON_tr`, respectively. The positions of the coolant channels was specified in `BISON.i` and `BISON_tr` files as such:


!listing microreactors/gcmr/assembly/steady_state/BISON.i start=coolant_full_points_filename end=coolant_half_points_filename include-end=true

The modelled assembly contains locations at which the full coolant channel is represented and in other locations, at the radial boundary, where only half coolant channel is considered. The files `coolant_full_points.txt` and `coolant_half_points.txt` include the positions of the full and half coolant channels, respectively. The full coolant channels positions are given as follows:



!listing microreactors/gcmr/assembly/channel_positions/coolant_full_points.txt


## SAM Model

The System Analysis Module (SAM) is a modern system analysis tool being developed by the NEAMS program for advanced non-LWR safety analysis. SAM was chosen as the system-level thermal-hydraulics code due to its capability to model 1D flow-channels at low computational cost. The coolant flow and conduction through the solid structures were modeled through a coupled SAM 1D Fluid – 3D solid simulation with a convective boundary condition at the solid-fluid interface. Temperatures are exchanged at the interface through the MOOSE MultiApps and Transfers systems. The SAM model utilized its built-in Helium material properties, along with 1D fluid components `PBOneDFluidComponent` to simulate the fluid flow of multiple helium coolant channels across the assembly. Additionally, to enable heat transfer between the fluid and solid domains at every time step through the MOOSE transfer system, SAM’s `HeatTransferWithExternalHeatStructure` component along `LayeredAverage` user objects were employed. For steady-state calculations the `SAM_full.i` and `SAM_half.i` are the SAM input files for full and half coolant channels, respectively.


## Multiphysics Coupling

Multiphysics simulations performed on microreactor models leverage the MOOSE MultiApp system to couple neutronics (Griffin), heat conduction in solid materials (BISON), and coolant channel heat energy transfers (SAM). The coupling logic of these different codes is shown in [Fig_3]. Each code has its own mesh and corresponding space and time scales.


!media media/gcmr/Fig_3.jpg
      style=display: block;margin-left:auto;margin-right:auto;width:60%;
      id=Fig_3
      caption= MultiApp modeling strategy


The 3-D power density distribution is calculated by Griffin and transferred to BISON for performing heat conduction calculations to estimate the fuel temperature. The coolant channels are modelled with SAM to estimate the coolant temperature distributions in all coolant channels. The MOOSE Picard fixed point iteration was used to attain a tightly coupled simulation, where the information is transferred back and forth between the three MOOSE-based applications until convergence of the power source distribution. The `MultiApps` blocks in `Griffin_steady_state.i` and `BISON.i` specify the MuliApp coupling for steady-state calculations, and the `MultiApps` blocks in `Griffin_transient.i ` and
`BISON_tr.i` specifies the MultiApp coupling for the transient problem. The Transfer system defined in the `Transfers` blocks, takes care of data interchange between the different applications, and controls what type of information is transferred and how the transfer will occur.

The power density and fuel temperatures transferred are defined through the [`Transfer system`](chp_6_transfers.md). Transfers block in the parent App (Griffin), where [`MultiAppProjectionTransfer`](https://mooseframework.inl.gov/source/transfers/MultiAppProjectionTransfer.html) was used which performs a projection between the parent App and the child App mesh files while conserving the integral of the transferred data. This is suitable for this case since the `BISON_mesh.e` and `Griffin_mesh.e` are only slightly different. However, generally, if the meshes are different, the `MultiAppShapeEvaluationTransfer` is recommended.


!listing microreactors/gcmr/assembly/steady_state/Griffin_steady_state.i block=Transfers
